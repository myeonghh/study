<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./bingoGame.css">
</head>
<body>
    <header><h1>ë¹™ê³  ê²Œì„</h1></header>
    <div class="winGame">
        ğŸ‰ì¶•í•˜í•©ë‹ˆë‹¤ ìŠ¹ë¦¬í•˜ì˜€ìŠµë‹ˆë‹¤ğŸ‰    
    </div>
    <div class="loseGame"></div>
    <main id="bingoGame">
        <section class="user">

        </section>
        <section class="computer">

        </section>
    </main>
    <script>
        // ë³€ìˆ˜ ì„ ì–¸
        let tableRow;
        let tableCol;
        let colInput;

        let tableRows;
        let tableCols;
        let tableInput;
        let inputNum;
        let userNumArr;
        let colNumArr;
        let userSubmitNum;
        let choiceNumText;
        let bingoCnt;
        let leftCrossZeroCnt;
        let rightCrossZeroCnt;
        let isDup;

        // DOM
        let bgMainDiv = document.querySelector('#bingoGame');
        let userDiv = document.querySelector('.user');
        let computerDiv = document.querySelector('.computer');
        let winGameDiv = document.querySelector('.winGame');


        // ë¹™ê³ ê²Œì„ í‹€ ë§Œë“¤ê¸°
        let bingoTable = document.createElement('table');
        bingoTable.setAttribute('class', 'bingoTable');
        userDiv.appendChild(bingoTable);
        let cnt = 1;
        for(let i = 0; i < 5; i++){
            tableRow = document.createElement('tr');
            tableRow.setAttribute('class', `row`);
            bingoTable.appendChild(tableRow);
            
            for(let j = 0; j < 5; j++){
                tableCol = document.createElement('td');
                tableCol.setAttribute('class', `col`);
                tableRow.appendChild(tableCol);

                tableCol.innerHTML += 
                `<input type="text" class="input input${i}${j}" value="${cnt}">`;
                cnt++;                              
            };
        };
        
        // ê²Œì„ ì‹œì‘ë²„íŠ¼ ìš”ì†Œ ì¶”ê°€
        let startBtn = document.createElement('button');
        startBtn.setAttribute('class', 'startBtn');
        startBtn.innerText = 'ê²Œì„ ì‹œì‘';
        userDiv.appendChild(startBtn);
        // ìˆ«ì ì œì¶œ ì „ì²´ êµ¬ì—­
        let submitDiv = document.createElement('div');
        submitDiv.setAttribute('class', 'submitDiv');
        userDiv.appendChild(submitDiv);
        // ìˆ«ì ì œì¶œ ì¸í’‹ì°½ ì¶”ê°€
        let choiceNumInput = document.createElement('input');
        choiceNumInput.setAttribute('type', 'text');
        choiceNumInput.setAttribute('class', 'choiceNumInput');
        submitDiv.appendChild(choiceNumInput);
        // ìˆ«ì ì œì¶œ ë²„íŠ¼ ì¶”ê°€
        let submitBtn = document.createElement('button');
        submitBtn.setAttribute('class', 'submitBtn');
        submitBtn.innerText = 'ë“±ë¡';
        submitDiv.appendChild(submitBtn);


        
        /**-------------------------------------------------í•¨ìˆ˜ ëª¨ìŒ---------------------------------------------------------*/
        // ì´ì¤‘ë°°ì—´ì— ì‚¬ìš©ìê°€ ì…ë ¥í•œ ë¹™ê³ ë²ˆí˜¸ë¥¼ ì¶”ê°€ì‹œì¼œì£¼ëŠ” í•¨ìˆ˜
        function addInputNum(_bingoTable){
            tableRows = _bingoTable.childNodes;

            tableRows.forEach(tableRow => {
                tableCols = tableRow.childNodes;
                colNumArr = [];
                tableCols.forEach(tableCol => {
                    
                    tableInput = tableCol.firstChild;
                    inputNum = Number(tableInput.value);
                    colNumArr.push(inputNum);
                    
                });
                console.log('colNumArr', colNumArr);
                userNumArr.push(colNumArr);
            });
        };

        // ì‚¬ìš©ìê°€ ì…ë ¥í•œ ë¹™ê³ ìˆ«ìë“¤ì„ í™•ì •ë°›ì•„ ë³´ì—¬ì£¼ëŠ” í•¨ìˆ˜
        function showInputNum(_bingoTable){
            tableRows = _bingoTable.childNodes;

            tableRows.forEach(tableRow => {
                tableCols = tableRow.childNodes;

                tableCols.forEach(tableCol => {
                    tableInput = tableCol.firstChild;
  
                    tableInput.style.display = 'none';
                    tableInput.parentNode.innerHTML += `<span class="confirmNum">${tableInput.value}</span>`;
                });
            });
        };
        
        // ë°°ì—´ì—ì„œ ì„ íƒí•œ ìˆ«ìë¥¼ 0ìœ¼ë¡œ ë°”ê¿”ì£¼ê³  ë°°ê²½ìƒ‰ ë‹¬ë¼ì§€ëŠ” í´ë˜ìŠ¤ë¥¼ ì¶”ê°€í•´ì£¼ëŠ” í•¨ìˆ˜!!
        function changeChoiceNum(userNumArr, userSubmitNum){
            for(let i = 0; i < userNumArr.length; i++){
                for(let j = 0; j < userNumArr[i].length; j++){
                    // ìœ ì €ê°€ ì œì¶œí•œ ìˆ«ìì™€ ì´ì „ì— ë“±ë¡í–ˆë˜ ìˆ«ìê°€ ì¼ì¹˜ì‹œ 
                    if(userSubmitNum === userNumArr[i][j]){
                        userNumArr[i][j] = 0;
                        choiceNumText = document.querySelector(`.input${i}${j}`).nextSibling;
                        
                        choiceNumText.parentNode.classList.add('check');
                    };
                };
            };
        };
        

        // ë¹™ê³  ìˆ«ì ì„¸ì£¼ëŠ” í•¨ìˆ˜!!!!!!!!
        function countBingo(userNumArr){
            bingoCnt = 0;
            leftCrossZeroCnt = 0;
            rightCrossZeroCnt = 0;

            for(let i = 0; i < userNumArr.length; i++){
                let rowZeroCnt = 0;

                // ì™¼ìª½ ëŒ€ê° 0 ìˆ«ì ì„¸ê¸°
                if(userNumArr[i][i] === 0){
                    leftCrossZeroCnt++;
                };
                // ì˜¤ë¥¸ ìª½ ëŒ€ê° 0 ìˆ«ì ì„¸ê¸°
                if(userNumArr[i][userNumArr.length - (i+1)] === 0){
                    rightCrossZeroCnt++;
                };
                // ì—´ 0 ìˆ«ì ì„¸ê¸°
                for(let j = 0; j < userNumArr[i].length; j++){
                    if(userNumArr[j][i] === 0){
                        rowZeroCnt++;
                    };
                };
                // í–‰ ë¹™ê³ ì¹´ìš´íŠ¸
                if((userNumArr[i].filter(item => item === 0)).length === 5){
                    bingoCnt++;
                };
                // ì—´ ë¹™ê³  ì¹´ìš´íŠ¸
                if(rowZeroCnt === 5){
                    bingoCnt++;
                };
                // ì™¼ìª½ ëŒ€ê° ë¹™ê³ ì¹´ìš´íŠ¸
                if(leftCrossZeroCnt === 5){
                    bingoCnt++;
                };
                // ì˜¤ë¥¸ìª½ ëŒ€ê° ë¹™ê³ ì¹´ìš´íŠ¸
                if(rightCrossZeroCnt === 5){
                    bingoCnt++;
                };
            };            
            console.log('bingoCnt', bingoCnt);
            return bingoCnt;
        };

        // ì²˜ìŒ ì…ë ¥í•œ ìˆ«ì ì¤‘ë³µì²´í¬í•´ì£¼ëŠ” í•¨ìˆ˜!!!!!
        function checkDup(userNumArr){
            let totalNumArr = []
            isDup = false;
            for(let i = 0; i < userNumArr.length; i++){
                for(let j = 0; j < userNumArr[i].length; j++){
                    totalNumArr.push(userNumArr[i][j]);
                };
            };
            let setArr = new Set(totalNumArr);
            if(totalNumArr.length !== setArr.size){
                isDup = true;
            }
            return isDup;
        };





        /**----------------------------------------------------------------------------------------------------*/
        /** -------------------------------------------ë²„íŠ¼ ì´ë²¤íŠ¸ ëª¨ìŒ------------------------------------------------*/
        // ë“±ë¡ ë²„íŠ¼ ë¹„í™œì„±í™”
        submitBtn.disabled = true;

        startBtn.addEventListener('click', function(){

            userNumArr = [];
            addInputNum(bingoTable);
            console.log('ì „ì²´ ë°°ì—´', userNumArr);
            console.log('colë°°ì—´', colNumArr);
            console.log('í•¨ìˆ˜ í™•ì¸í•˜ê¸°', checkDup(userNumArr));
            for(let i = 0; i < userNumArr.length; i++){
                for(let j = 0; j < userNumArr[i].length; j++){
                    // ë¹™ê³  ìˆ«ì ì…ë ¥ ì˜ˆì™¸ì²˜ë¦¬!!!!!!
                    if(isNaN(userNumArr[i][j]) || userNumArr[i][j] < 1 || userNumArr[i][j] > 25 || checkDup(userNumArr)){
                        alert('1ë¶€í„° 25ì‚¬ì´ì˜ ì •ìˆ˜ë¥¼ ëª¨ë“ ì¹¸ì— ì¤‘ë³µì—†ì´ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                        return;
                    };
                };
            };
            // ì‚¬ìš©ìê°€ ì…ë ¥í•œ ë¹™ê³ ìˆ«ìë“¤ì„ í™•ì •ë°›ì•„ ë³´ì—¬ì£¼ëŠ” í•¨ìˆ˜ í˜¸ì¶œ!
            showInputNum(bingoTable);

            // ë“±ë¡ ë²„íŠ¼ í™œì„±í™”
            submitBtn.disabled = false;
            choiceNumInput.focus();
            choiceNumInput.value = '';
            startBtn.disabled = true;
        });

       
        submitBtn.addEventListener('click', function(){
            let bingoCnt = 0;
            let leftCrossZeroCnt = 0;
            let rightCrossZeroCnt = 0;
            userSubmitNum = Number(choiceNumInput.value);

            console.log('ìœ ì €ë„˜ì–´ë ˆì´', userNumArr);
            if(!Boolean(userSubmitNum) || userSubmitNum < 1 || userSubmitNum > 25){
                choiceNumInput.focus();
                choiceNumInput.value = '';
                alert('1ë¶€í„° 25ì‚¬ì´ì˜ ì •ìˆ˜ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”!');
                return;
            }
            isDup = true;
            for(let i = 0; i < userNumArr.length; i++){
                if(userNumArr[i].includes(userSubmitNum)){
                    isDup = false;
                    break;
                };
            };
            if(isDup){
                choiceNumInput.focus();
                choiceNumInput.value = '';
                alert('ì´ë¯¸ í•´ë‹¹ìˆ«ìë¥¼ ì…ë ¥í–ˆìŠµë‹ˆë‹¤. ë‹¤ë¥¸ ìˆ«ìë¥¼ ì…ë ¥í•˜ì„¸ìš”!');
                return;
            };
            // ë°°ì—´ì—ì„œ ì„ íƒí•œ ìˆ«ìë¥¼ 0ìœ¼ë¡œ ë°”ê¿”ì£¼ê³  ë°°ê²½ìƒ‰ ë‹¬ë¼ì§€ëŠ” í´ë˜ìŠ¤ë¥¼ ì¶”ê°€í•´ì£¼ëŠ” í•¨ìˆ˜ í˜¸ì¶œ
            changeChoiceNum(userNumArr, userSubmitNum);
            // ë¹™ê³ ìˆ«ì ì„¸ì£¼ëŠ” í•¨ìˆ˜ í˜¸ì¶œ
            bingoCnt = countBingo(userNumArr);

            choiceNumInput.focus();
            choiceNumInput.value = '';

            if(bingoCnt > 4){
                console.log('ë¹™ê³ ë‹¬ì„±!!!!!');
                winGameDiv.style.display = 'flex';
                return;
            };
        });
        
        /**--------------------------------------------------------------------------------------------------*/
       

    </script>
</body>
</html>