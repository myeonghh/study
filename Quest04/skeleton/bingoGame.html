<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./bingoGame.css">
</head>
<body>
    <header><h1>빙고 게임</h1></header>
    <div class="winGame">
        🎉축하합니다 승리하였습니다🎉    
    </div>
    <div class="loseGame"></div>
    <main id="bingoGame">
        <section class="user">

        </section>
        <section class="computer">

        </section>
    </main>
    <script>
        // 변수 선언
        let tableRow;
        let tableCol;
        let colInput;

        let tableRows;
        let tableCols;
        let tableInput;
        let inputNum;
        let userNumArr;
        let colNumArr;
        let userSubmitNum;
        let choiceNumText;
        let bingoCnt;
        let leftCrossZeroCnt;
        let rightCrossZeroCnt;
        let isDup;

        // DOM
        let bgMainDiv = document.querySelector('#bingoGame');
        let userDiv = document.querySelector('.user');
        let computerDiv = document.querySelector('.computer');
        let winGameDiv = document.querySelector('.winGame');


        // 빙고게임 틀 만들기
        let bingoTable = document.createElement('table');
        bingoTable.setAttribute('class', 'bingoTable');
        userDiv.appendChild(bingoTable);
        let cnt = 1;
        for(let i = 0; i < 5; i++){
            tableRow = document.createElement('tr');
            tableRow.setAttribute('class', `row`);
            bingoTable.appendChild(tableRow);
            
            for(let j = 0; j < 5; j++){
                tableCol = document.createElement('td');
                tableCol.setAttribute('class', `col`);
                tableRow.appendChild(tableCol);

                tableCol.innerHTML += 
                `<input type="text" class="input input${i}${j}" value="${cnt}">`;
                cnt++;                              
            };
        };
        
        // 게임 시작버튼 요소 추가
        let startBtn = document.createElement('button');
        startBtn.setAttribute('class', 'startBtn');
        startBtn.innerText = '게임 시작';
        userDiv.appendChild(startBtn);
        // 숫자 제출 전체 구역
        let submitDiv = document.createElement('div');
        submitDiv.setAttribute('class', 'submitDiv');
        userDiv.appendChild(submitDiv);
        // 숫자 제출 인풋창 추가
        let choiceNumInput = document.createElement('input');
        choiceNumInput.setAttribute('type', 'text');
        choiceNumInput.setAttribute('class', 'choiceNumInput');
        submitDiv.appendChild(choiceNumInput);
        // 숫자 제출 버튼 추가
        let submitBtn = document.createElement('button');
        submitBtn.setAttribute('class', 'submitBtn');
        submitBtn.innerText = '등록';
        submitDiv.appendChild(submitBtn);


        
        /**-------------------------------------------------함수 모음---------------------------------------------------------*/
        // 이중배열에 사용자가 입력한 빙고번호를 추가시켜주는 함수
        function addInputNum(_bingoTable){
            tableRows = _bingoTable.childNodes;

            tableRows.forEach(tableRow => {
                tableCols = tableRow.childNodes;
                colNumArr = [];
                tableCols.forEach(tableCol => {
                    
                    tableInput = tableCol.firstChild;
                    inputNum = Number(tableInput.value);
                    colNumArr.push(inputNum);
                    
                });
                console.log('colNumArr', colNumArr);
                userNumArr.push(colNumArr);
            });
        };

        // 사용자가 입력한 빙고숫자들을 확정받아 보여주는 함수
        function showInputNum(_bingoTable){
            tableRows = _bingoTable.childNodes;

            tableRows.forEach(tableRow => {
                tableCols = tableRow.childNodes;

                tableCols.forEach(tableCol => {
                    tableInput = tableCol.firstChild;
  
                    tableInput.style.display = 'none';
                    tableInput.parentNode.innerHTML += `<span class="confirmNum">${tableInput.value}</span>`;
                });
            });
        };
        
        // 배열에서 선택한 숫자를 0으로 바꿔주고 배경색 달라지는 클래스를 추가해주는 함수!!
        function changeChoiceNum(userNumArr, userSubmitNum){
            for(let i = 0; i < userNumArr.length; i++){
                for(let j = 0; j < userNumArr[i].length; j++){
                    // 유저가 제출한 숫자와 이전에 등록했던 숫자가 일치시 
                    if(userSubmitNum === userNumArr[i][j]){
                        userNumArr[i][j] = 0;
                        choiceNumText = document.querySelector(`.input${i}${j}`).nextSibling;
                        
                        choiceNumText.parentNode.classList.add('check');
                    };
                };
            };
        };
        

        // 빙고 숫자 세주는 함수!!!!!!!!
        function countBingo(userNumArr){
            bingoCnt = 0;
            leftCrossZeroCnt = 0;
            rightCrossZeroCnt = 0;

            for(let i = 0; i < userNumArr.length; i++){
                let rowZeroCnt = 0;

                // 왼쪽 대각 0 숫자 세기
                if(userNumArr[i][i] === 0){
                    leftCrossZeroCnt++;
                };
                // 오른 쪽 대각 0 숫자 세기
                if(userNumArr[i][userNumArr.length - (i+1)] === 0){
                    rightCrossZeroCnt++;
                };
                // 열 0 숫자 세기
                for(let j = 0; j < userNumArr[i].length; j++){
                    if(userNumArr[j][i] === 0){
                        rowZeroCnt++;
                    };
                };
                // 행 빙고카운트
                if((userNumArr[i].filter(item => item === 0)).length === 5){
                    bingoCnt++;
                };
                // 열 빙고 카운트
                if(rowZeroCnt === 5){
                    bingoCnt++;
                };
                // 왼쪽 대각 빙고카운트
                if(leftCrossZeroCnt === 5){
                    bingoCnt++;
                };
                // 오른쪽 대각 빙고카운트
                if(rightCrossZeroCnt === 5){
                    bingoCnt++;
                };
            };            
            console.log('bingoCnt', bingoCnt);
            return bingoCnt;
        };

        // 처음 입력한 숫자 중복체크해주는 함수!!!!!
        function checkDup(userNumArr){
            let totalNumArr = []
            isDup = false;
            for(let i = 0; i < userNumArr.length; i++){
                for(let j = 0; j < userNumArr[i].length; j++){
                    totalNumArr.push(userNumArr[i][j]);
                };
            };
            let setArr = new Set(totalNumArr);
            if(totalNumArr.length !== setArr.size){
                isDup = true;
            }
            return isDup;
        };





        /**----------------------------------------------------------------------------------------------------*/
        /** -------------------------------------------버튼 이벤트 모음------------------------------------------------*/
        // 등록 버튼 비활성화
        submitBtn.disabled = true;

        startBtn.addEventListener('click', function(){

            userNumArr = [];
            addInputNum(bingoTable);
            console.log('전체 배열', userNumArr);
            console.log('col배열', colNumArr);
            console.log('함수 확인하기', checkDup(userNumArr));
            for(let i = 0; i < userNumArr.length; i++){
                for(let j = 0; j < userNumArr[i].length; j++){
                    // 빙고 숫자 입력 예외처리!!!!!!
                    if(isNaN(userNumArr[i][j]) || userNumArr[i][j] < 1 || userNumArr[i][j] > 25 || checkDup(userNumArr)){
                        alert('1부터 25사이의 정수를 모든칸에 중복없이 입력해주세요!');
                        return;
                    };
                };
            };
            // 사용자가 입력한 빙고숫자들을 확정받아 보여주는 함수 호출!
            showInputNum(bingoTable);

            // 등록 버튼 활성화
            submitBtn.disabled = false;
            choiceNumInput.focus();
            choiceNumInput.value = '';
            startBtn.disabled = true;
        });

       
        submitBtn.addEventListener('click', function(){
            let bingoCnt = 0;
            let leftCrossZeroCnt = 0;
            let rightCrossZeroCnt = 0;
            userSubmitNum = Number(choiceNumInput.value);

            console.log('유저넘어레이', userNumArr);
            if(!Boolean(userSubmitNum) || userSubmitNum < 1 || userSubmitNum > 25){
                choiceNumInput.focus();
                choiceNumInput.value = '';
                alert('1부터 25사이의 정수를 입력해 주세요!');
                return;
            }
            isDup = true;
            for(let i = 0; i < userNumArr.length; i++){
                if(userNumArr[i].includes(userSubmitNum)){
                    isDup = false;
                    break;
                };
            };
            if(isDup){
                choiceNumInput.focus();
                choiceNumInput.value = '';
                alert('이미 해당숫자를 입력했습니다. 다른 숫자를 입력하세요!');
                return;
            };
            // 배열에서 선택한 숫자를 0으로 바꿔주고 배경색 달라지는 클래스를 추가해주는 함수 호출
            changeChoiceNum(userNumArr, userSubmitNum);
            // 빙고숫자 세주는 함수 호출
            bingoCnt = countBingo(userNumArr);

            choiceNumInput.focus();
            choiceNumInput.value = '';

            if(bingoCnt > 4){
                console.log('빙고달성!!!!!');
                winGameDiv.style.display = 'flex';
                return;
            };
        });
        
        /**--------------------------------------------------------------------------------------------------*/
       

    </script>
</body>
</html>